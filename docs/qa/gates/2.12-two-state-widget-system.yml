schema: 1
story: '2.12'
story_title: 'Two-State Widget System (Collapsed/Expanded)'
gate: CONCERNS
status_reason: 'Partial implementation with architectural inconsistencies. EngineWidget has basic toggle functionality but lacks standardized pattern, animation system, and integration with persistence.'
reviewer: 'Quinn (Test Architect)'
updated: '2025-10-13T12:00:00Z'

top_issues:
  - severity: medium
    category: architecture
    description: 'Required WidgetShell component for standardized expand/collapse behavior does not exist'
    suggested_owner: dev
    refs: ['src/components/WidgetShell.tsx (missing)']
  - severity: medium
    category: consistency
    description: 'Only EngineWidget has toggle functionality - other widgets lack expand/collapse implementation'
    suggested_owner: dev
    refs: ['src/widgets/DepthWidget.tsx', 'src/widgets/WindWidget.tsx', 'src/widgets/BatteryWidget.tsx']
  - severity: medium
    category: persistence
    description: 'WidgetLayout interface missing expanded boolean field for state persistence'
    suggested_owner: dev
    refs: ['src/services/layoutService.ts:4-8']

waiver: { active: false }

quality_score: 50
expires: '2025-10-27T12:00:00Z'

evidence:
  tests_reviewed: 0
  risks_identified: 5
  trace:
    ac_covered: [2]
    ac_gaps: [1, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22]

nfr_validation:
  security:
    status: PASS
    notes: 'Widget state changes are presentation-layer only with no security implications'
  performance:
    status: CONCERNS
    notes: 'No animation optimization system - could cause UI lag during expand/collapse transitions'
  reliability:
    status: CONCERNS
    notes: 'Inconsistent widget behavior reduces dashboard reliability and user trust'
  maintainability:
    status: CONCERNS
    notes: 'Each widget implements custom toggle pattern instead of standardized WidgetShell component'

recommendations:
  immediate:
    - action: 'Create WidgetShell component with standardized tap-to-expand behavior and 300ms animations'
      refs: ['src/components/WidgetShell.tsx']
    - action: 'Update WidgetLayout interface to include expanded boolean field for state persistence'
      refs: ['src/services/layoutService.ts:4-8']
    - action: 'Add chevron system to WidgetCard header replacing status dot system'
      refs: ['src/widgets/WidgetCard.tsx']
    - action: 'Refactor EngineWidget from selectedView pattern to standardized expanded boolean'
      refs: ['src/widgets/EngineWidget.tsx:18', 'src/widgets/EngineWidget.tsx:154']
    - action: 'Implement expand/collapse for DepthWidget (collapsed: depth only, expanded: + trend graph)'
      refs: ['src/widgets/DepthWidget.tsx']
  future:
    - action: 'Add React Native Reanimated for 60fps height transition animations'
      refs: ['src/components/WidgetShell.tsx']
    - action: 'Create comprehensive test suite for expand/collapse behavior across all widgets'
      refs: ['__tests__/WidgetShell.test.tsx', '__tests__/widget-expansion.test.tsx']
    - action: 'Add consistent sizing validation (180×180pt collapsed, 180×280pt expanded)'
      refs: ['__tests__/widget-sizing.test.tsx']