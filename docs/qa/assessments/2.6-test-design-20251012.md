# Test Design: Story 2.6 - Autopilot Status & Rudder Position Widgets

**Date:** October 12, 2025  
**Designer:** Quinn (Test Architect)  
**Story:** 2.6 - Autopilot Status & Rudder Position Widgets  
**Epic:** Epic 2 - NMEA2000, Widget Framework & Complete Instrument Suite

## Test Strategy Overview

- **Total test scenarios:** 32
- **Unit tests:** 24 (75%) - Focus on business logic and calculations
- **Integration tests:** 6 (19%) - Widget framework and NMEA data integration
- **E2E tests:** 2 (6%) - Critical user workflows
- **Priority distribution:** P0: 14, P1: 12, P2: 4, P3: 2

**Strategy Rationale:** Marine autopilot monitoring requires comprehensive testing at all levels with emphasis on safety calculations and business logic validation. Unit tests dominate due to complex autopilot state logic and marine safety calculations.

## Test Scenarios by Acceptance Criteria

### AC1: Autopilot Mode Display (off/standby/auto/wind/nav)

#### Scenarios

| ID           | Level       | Priority | Test                                    | Justification                          |
| ------------ | ----------- | -------- | --------------------------------------- | -------------------------------------- |
| 2.6-UNIT-001 | Unit        | P0       | Mode classification logic               | Critical safety - mode interpretation  |
| 2.6-UNIT-002 | Unit        | P0       | Mode color coding calculations          | Visual safety indication logic         |
| 2.6-UNIT-003 | Unit        | P1       | Invalid mode handling                   | Error resilience for unknown modes     |
| 2.6-INT-001  | Integration | P1       | Mode data from NMEA store integration  | Widget-store data flow validation      |

### AC2: Target Heading/Wind Angle Display

#### Scenarios

| ID           | Level       | Priority | Test                                    | Justification                          |
| ------------ | ----------- | -------- | --------------------------------------- | -------------------------------------- |
| 2.6-UNIT-004 | Unit        | P0       | Heading angle normalization (0-359°)   | Navigation accuracy - angle arithmetic |
| 2.6-UNIT-005 | Unit        | P0       | Target vs actual heading calculation    | Critical for navigation safety         |
| 2.6-UNIT-006 | Unit        | P1       | Wind angle conversion and display       | Wind mode functionality                |
| 2.6-UNIT-007 | Unit        | P2       | Heading undefined state handling        | Graceful degradation                   |

### AC3: Autopilot Engagement Status Display

#### Scenarios

| ID           | Level       | Priority | Test                                    | Justification                          |
| ------------ | ----------- | -------- | --------------------------------------- | -------------------------------------- |
| 2.6-UNIT-008 | Unit        | P0       | Engagement state classification         | Critical safety - active/standby logic |
| 2.6-UNIT-009 | Unit        | P0       | Engagement visual indicator logic       | Safety-critical visual feedback        |
| 2.6-UNIT-010 | Unit        | P1       | Multiple engagement flag handling       | Handle engaged/active flag variations  |

### AC4: Error Message Display from Autopilot System

#### Scenarios

| ID           | Level       | Priority | Test                                    | Justification                          |
| ------------ | ----------- | -------- | --------------------------------------- | -------------------------------------- |
| 2.6-UNIT-011 | Unit        | P0       | Alarm message processing and display    | Critical safety - error communication |
| 2.6-UNIT-012 | Unit        | P0       | Error state widget classification       | Visual alarm state logic               |
| 2.6-UNIT-013 | Unit        | P1       | Multiple alarm handling priority        | Multiple simultaneous error handling   |

### AC5: GPS/Compass Source Display for Navigation Modes

#### Scenarios

| ID           | Level       | Priority | Test                                    | Justification                          |
| ------------ | ----------- | -------- | --------------------------------------- | -------------------------------------- |
| 2.6-UNIT-014 | Unit        | P1       | Heading source identification logic     | Navigation source transparency         |
| 2.6-UNIT-015 | Unit        | P2       | Source display in details view         | Information completeness               |

### AC6: Rudder Angle Visual Indicator

#### Scenarios

| ID           | Level       | Priority | Test                                    | Justification                          |
| ------------ | ----------- | -------- | --------------------------------------- | -------------------------------------- |
| 2.6-UNIT-016 | Unit        | P0       | Rudder angle classification (normal/caution/alarm) | Marine safety - angle threshold logic |
| 2.6-UNIT-017 | Unit        | P0       | Angle clamping for visualization (-45° to +45°) | Display boundary calculations         |
| 2.6-UNIT-018 | Unit        | P1       | Rudder angle rotation calculation       | SVG transform mathematics              |
| 2.6-E2E-001  | E2E         | P1       | Complete rudder visualization workflow  | End-to-end visual validation           |

### AC7: Port/Starboard Position Clarity

#### Scenarios

| ID           | Level       | Priority | Test                                    | Justification                          |
| ------------ | ----------- | -------- | --------------------------------------- | -------------------------------------- |
| 2.6-UNIT-019 | Unit        | P0       | Port/starboard side determination       | Marine safety - directional accuracy  |
| 2.6-UNIT-020 | Unit        | P1       | Side label display logic                | Clear directional communication        |

### AC8: Rudder Movement Trends

#### Scenarios

| ID           | Level       | Priority | Test                                    | Justification                          |
| ------------ | ----------- | -------- | --------------------------------------- | -------------------------------------- |
| 2.6-UNIT-021 | Unit        | P2       | Real-time angle display updates         | Movement visualization logic           |
| 2.6-INT-002  | Integration | P2       | Angle change detection over time        | Trending calculation with data flow    |

### AC9: Configurable Rudder Angle Limits

#### Scenarios

| ID           | Level       | Priority | Test                                    | Justification                          |
| ------------ | ----------- | -------- | --------------------------------------- | -------------------------------------- |
| 2.6-UNIT-022 | Unit        | P0       | Warning threshold logic (20°/30° limits) | Marine safety - configurable limits  |
| 2.6-UNIT-023 | Unit        | P1       | Threshold configuration validation      | User setting boundary validation       |

### AC10: Visual Warnings for Extreme Rudder Positions

#### Scenarios

| ID           | Level       | Priority | Test                                    | Justification                          |
| ------------ | ----------- | -------- | --------------------------------------- | -------------------------------------- |
| 2.6-UNIT-024 | Unit        | P0       | Extreme angle warning logic (>30°)     | Critical safety - extreme position detection |
| 2.6-INT-003  | Integration | P1       | Warning state propagation to widget     | Safety warning system integration     |

### AC11: NMEA2000 Rudder Position PGN (127245)

#### Scenarios

| ID           | Level       | Priority | Test                                    | Justification                          |
| ------------ | ----------- | -------- | --------------------------------------- | -------------------------------------- |
| 2.6-INT-004  | Integration | P0       | Rudder PGN data integration             | Critical data source connection        |
| 2.6-INT-005  | Integration | P1       | PGN data validation and error handling  | Data integrity and error resilience   |

### AC12: NMEA2000 Autopilot Status PGNs

#### Scenarios

| ID           | Level       | Priority | Test                                    | Justification                          |
| ------------ | ----------- | -------- | --------------------------------------- | -------------------------------------- |
| 2.6-INT-006  | Integration | P0       | Autopilot PGN data integration          | Core autopilot monitoring data source |

### AC13: Read-Only Status Display

#### Scenarios

| ID           | Level       | Priority | Test                                    | Justification                          |
| ------------ | ----------- | -------- | --------------------------------------- | -------------------------------------- |
| 2.6-E2E-002  | E2E         | P1       | No control elements present in UI       | Epic 2 scope boundary validation      |

### AC14: Multi-System Compatibility (Raymarine Evolution + Others)

#### Scenarios

| ID           | Level       | Priority | Test                                    | Justification                          |
| ------------ | ----------- | -------- | --------------------------------------- | -------------------------------------- |
| 2.6-UNIT-025 | Unit        | P2       | Generic autopilot data structure        | Multi-brand compatibility logic        |
| 2.6-UNIT-026 | Unit        | P3       | Brand-specific data adaptation          | Extensibility for future brands        |

## Risk Coverage Analysis

**Mapping to identified risks from risk profile (2.6-risk-20251012.md):**

### SEC-001: Marine Safety Data Validation Gap (Score: 6 - High)
**Covered by:** 2.6-UNIT-001, 2.6-UNIT-008, 2.6-UNIT-016, 2.6-UNIT-019, 2.6-UNIT-022, 2.6-UNIT-024, 2.6-INT-004, 2.6-INT-005, 2.6-INT-006

### PERF-001: SVG Rendering Performance (Score: 4 - Medium)
**Test Gap:** Performance testing deferred to integration phase - focus on business logic validation

### TECH-001: NMEA2000 PGN Integration Dependency (Score: 4 - Medium)
**Covered by:** 2.6-INT-004, 2.6-INT-005, 2.6-INT-006

### DATA-001: Autopilot State Synchronization (Score: 4 - Medium)
**Covered by:** 2.6-INT-001, 2.6-INT-003, 2.6-INT-006

## Marine Safety Test Focus Areas

### Critical Marine Safety Tests (P0 Priority)

1. **Autopilot Mode Classification** (2.6-UNIT-001): Ensures correct interpretation of autopilot modes for safety-critical navigation decisions
2. **Engagement State Logic** (2.6-UNIT-008): Validates active/standby state determination for helm control awareness
3. **Rudder Angle Safety Thresholds** (2.6-UNIT-016, 2.6-UNIT-022, 2.6-UNIT-024): Marine industry standard angle limits and extreme position detection
4. **Heading Calculations** (2.6-UNIT-004, 2.6-UNIT-005): Navigation accuracy through proper angle arithmetic and compass normalization
5. **Alarm Processing** (2.6-UNIT-011): Critical safety communication from autopilot systems to operator
6. **Port/Starboard Accuracy** (2.6-UNIT-019): Directional accuracy essential for marine maneuvering

### Marine Test Data Requirements

```yaml
test_data:
  autopilot_modes:
    - OFF, STANDBY, AUTO, WIND, NAV, TRACK
    - Invalid modes for error handling
  rudder_angles:
    - Normal range: -20° to +20°
    - Caution range: -30° to -20°, +20° to +30°
    - Alarm range: < -30°, > +30°
    - Extreme test: ±45° (hardware limits)
  heading_data:
    - Full compass range: 0° to 359°
    - Boundary conditions: 0°/360° wraparound
    - Invalid values: negative, > 360°
  engagement_states:
    - engaged: true/false
    - active: true/false
    - Combined state scenarios
```

## Recommended Execution Order

### Phase 1: Critical Safety Tests (P0)
1. **Marine Safety Logic** (2.6-UNIT-001, 008, 016, 019, 022, 024) - Fail fast on safety calculations
2. **Navigation Calculations** (2.6-UNIT-004, 005) - Core heading arithmetic
3. **Alarm Systems** (2.6-UNIT-011, 012) - Safety communication logic
4. **Data Integration** (2.6-INT-004, 006) - Critical NMEA data flow

### Phase 2: Core Functionality Tests (P1)
1. **UI Logic Validation** (2.6-UNIT-003, 006, 009, 010, 013, 014, 017, 020, 023) - Core user interface behavior
2. **Integration Validation** (2.6-INT-001, 003, 005) - Widget framework integration
3. **End-to-End Workflows** (2.6-E2E-001, 002) - Complete user scenarios

### Phase 3: Enhancement Tests (P2-P3)
1. **Secondary Features** (2.6-UNIT-007, 015, 021, 025) - Enhanced functionality
2. **Future Extensibility** (2.6-UNIT-026) - Multi-brand preparation
3. **Trending Features** (2.6-INT-002) - Movement analysis

## Test Implementation Notes

### Unit Test Focus Areas
- **Business Logic Validation:** All marine safety calculations and autopilot state logic
- **Calculation Accuracy:** Heading arithmetic, angle normalization, threshold detection
- **Error Handling:** Invalid data scenarios and graceful degradation
- **State Management:** Widget state classification based on autopilot data

### Integration Test Focus Areas
- **NMEA Data Flow:** PGN parsing to widget display pipeline
- **Widget Framework:** WidgetCard integration and state propagation
- **Store Integration:** useNmeaStore selector efficiency and accuracy

### E2E Test Focus Areas
- **Visual Validation:** Complete rudder and autopilot visualization workflows
- **User Interface:** Touch interaction and multi-view functionality
- **Scope Boundary:** Verification of read-only monitoring (no control elements)

## Coverage Gaps and Recommendations

### Identified Gaps
- **Performance Testing:** SVG rendering performance deferred to integration testing phase
- **Real Hardware Testing:** NMEA2000 autopilot system validation requires actual marine hardware
- **Visual Regression:** SVG component visual validation requires manual or screenshot testing

### Mitigation Strategies
1. **Business Logic Focus:** Comprehensive unit testing covers all critical calculations and safety logic
2. **Mock Data Strategy:** Extensive test data sets simulate various autopilot system scenarios
3. **Integration Phase:** Performance and visual testing planned for integration with real hardware

## Success Criteria

### Test Execution Success
- [ ] All P0 tests pass (14 scenarios) - Marine safety validation
- [ ] 95%+ P1 test pass rate (12 scenarios) - Core functionality
- [ ] P2+ tests executed as time permits (6 scenarios)

### Coverage Validation
- [ ] Every acceptance criterion has test coverage
- [ ] All identified risks have corresponding test scenarios
- [ ] Marine safety calculations comprehensively validated
- [ ] NMEA data integration pathways tested

### Quality Assurance
- [ ] Unit tests execute in <500ms total
- [ ] Integration tests validate real data flow scenarios
- [ ] E2E tests confirm complete user workflows
- [ ] Test scenarios are maintainable and stable

This test design provides comprehensive coverage for Story 2.6's autopilot monitoring widgets with emphasis on marine safety validation and business logic accuracy while avoiding over-testing through appropriate test level selection.