name: "Autopilot Engagement Scenario"
description: "Complete engagement sequence (manual → auto → heading adjustments → disengagement)"
duration: 300  # 5 minutes as per AC2
version: "1.0"
category: "autopilot"

# Vessel parameters
parameters:
  vessel:
    length: 12.2  # meters (can be overridden with ${VESSEL_LENGTH:12.2})
    type: "sailboat"
  conditions:
    wind_speed: [12, 18]
    target_heading: 270

# Progressive phase management as per AC2
phases:
  - phase: "manual_steering"
    duration: 60  # 1 minute
    autopilot_mode: "standby"
    description: "Manual steering mode, autopilot on standby"
    autopilot:
      mode: "STANDBY"
      engaged: false
    
  - phase: "engagement" 
    duration: 30  # 30 seconds
    autopilot_mode: "auto"
    target_heading: 270
    description: "Autopilot engagement with target heading"
    autopilot:
      mode: "COMPASS"
      engaged: true
      target_heading: 270
    
  - phase: "heading_adjustments"
    duration: 120  # 2 minutes
    autopilot_mode: "auto"
    description: "Active heading adjustments with timed events"
    autopilot:
      mode: "COMPASS"
      engaged: true
    events:
      - time: 30  # T+30s
        command: "adjust_heading"
        value: "+10"
        description: "Turn 10 degrees to starboard"
      - time: 90  # T+90s  
        command: "adjust_heading"
        value: "-5"
        description: "Turn 5 degrees to port"
        
  - phase: "disengagement"
    duration: 90  # 1.5 minutes
    autopilot_mode: "standby"
    description: "Return to manual steering"
    autopilot:
      mode: "STANDBY"
      engaged: false

# Data generation parameters
data:
  depth:
    type: "sine_wave"
    base: 20      # feet
    amplitude: 3  # ±3 feet (calmer waters)
    frequency: 0.05 # Hz (slower variation)
    unit: "feet"
  
  speed:
    type: "constant_with_variation"
    base: 7.0     # knots (autopilot maintains steady speed)
    variation: 0.2 # ±0.2 knots
    unit: "knots"
  
  wind:
    angle:
      type: "constant_with_drift"
      start: 30    # degrees
      drift_rate: 0.1 # degrees per minute
    speed:
      type: "gaussian"
      mean: 12     # knots (moderate wind)
      std_dev: 1.5
      min: 8
      max: 18
      unit: "knots"
  
  gps:
    type: "autopilot_track"
    start_position:
      latitude: 41.4200
      longitude: -81.8500
    initial_heading: 270  # Updated to match target heading
    track_precision: 1  # degrees (autopilot precision)

# NMEA sentence timing
timing:
  depth: 2      # Hz
  speed: 1      # Hz  
  wind: 2       # Hz
  gps: 1        # Hz
  compass: 10   # Hz
  autopilot: 4  # Hz (autopilot status broadcasting as per AC2)

# Bidirectional command/response validation
test_commands:
  - type: "engage"
    nmea0183: "$PCDIN,01F112,00,00,FF,00,00,00,00,FF*59"
    description: "Engage autopilot in compass mode"
  
  - type: "disengage"
    nmea0183: "$PCDIN,01F112,00,00,00,00,00,00,00,00*5A"
    description: "Disengage autopilot"
  
  - type: "heading_adjust_plus_10"
    nmea0183: "$PCDIN,01F113,00,0A,00,00,00,00,00,00*5D"
    description: "Adjust heading +10 degrees"
  
  - type: "heading_adjust_minus_5"
    nmea0183: "$PCDIN,01F113,00,FB,00,00,00,00,00,00*5E"
    description: "Adjust heading -5 degrees"

# Use cases
use_cases:
  - "Autopilot engagement testing with bidirectional commands"
  - "Phase-based autopilot behavior validation"
  - "Timed event triggers for heading adjustments"
  - "Command timeout and validation testing"

# Related acceptance criteria
acceptance_criteria:
  - "AC2: Complete engagement sequence (manual → auto → heading adjustments → disengagement)"
  - "AC2: Progressive phase management"
  - "AC2: Timed event triggers (heading adjustment at T+30s, T+90s)"
  - "AC2: Bidirectional command/response validation with autopilot control widgets"
