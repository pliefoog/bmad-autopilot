{"dependencies":[{"name":"../utils/ConversionRegistry","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":27,"column":0,"index":944},"end":{"line":27,"column":65,"index":1009}},{"start":{"line":27,"column":0,"index":944},"end":{"line":27,"column":65,"index":1009}},{"start":{"line":27,"column":0,"index":944},"end":{"line":27,"column":65,"index":1009}},{"start":{"line":27,"column":0,"index":944},"end":{"line":27,"column":65,"index":1009}}],"key":"Igqq9L/2ZYTXmPYauiWQBcPeoCw=","exportNames":["*"],"imports":4}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  Object.defineProperty(exports, \"__esModule\", {\n    value: true\n  });\n  exports.MetricValue = void 0;\n  /**\n   * MetricValue - Minimal Storage with Optional Unit Type\n   *\n   * **Architecture:**\n   * - Stores: si_value (8 bytes) + timestamp (8 bytes) + unitType (optional)\n   * - Display values computed on-demand (lazy getters) OR at construction if unitType provided\n   * - No persistence methods (toJSON/fromPlain removed)\n   * - No alarm state storage (moved to SensorInstance)\n   *\n   * **Usage:**\n   * ```typescript\n   * // With unitType (enriched at construction)\n   * const metric = new MetricValue(2.5, Date.now(), 'depth');\n   * const formatted = metric.getFormattedValue(); // \"8.2\" (pre-computed)\n   *\n   * // Without unitType (lazy computation)\n   * const metric = new MetricValue(2.5, Date.now());\n   * const display = metric.getDisplayValue('depth'); // 8.202 (computed on-demand)\n   * ```\n   *\n   * **NaN Handling:**\n   * - NaN is valid sentinel for \"no valid reading\"\n   * - Display values return \"---\" for NaN\n   */\n\n  /**\n   * MetricValue - Minimal metric storage\n   *\n   * Stores SI value, timestamp, and optional unitType.\n   * Display values computed on-demand or at construction if unitType provided.\n   */\n  class MetricValue {\n    /** Value in SI units (number or NaN for \"no reading\") */\n\n    /** Timestamp in ms */\n\n    /** Unit type for this metric (optional) */\n\n    /** Force UTC timezone for datetime display (optional) */\n\n    /**\n     * Create MetricValue\n     *\n     * @param si_value - Value in SI units (can be NaN for \"no reading\")\n     * @param timestamp - Timestamp in ms (defaults to now)\n     * @param unitType - Optional unit type for enrichment\n     * @param forceTimezone - Optional force UTC for datetime display (from field config)\n     */\n    constructor(si_value, timestamp = Date.now(), unitType, forceTimezone) {\n      // Allow NaN as valid sentinel value\n      if (typeof si_value !== 'number') {\n        throw new Error(`MetricValue: si_value must be number, got ${typeof si_value}`);\n      }\n      if (!Number.isNaN(si_value) && !Number.isFinite(si_value)) {\n        throw new Error(`MetricValue: si_value cannot be Infinity`);\n      }\n      this.si_value = si_value;\n      this.timestamp = timestamp;\n      this._unitType = unitType;\n      this._forceTimezone = forceTimezone;\n    }\n\n    /**\n     * Get unitType for this metric\n     */\n    getUnitType() {\n      return this._unitType;\n    }\n\n    /**\n     * Get display value (lazy computation)\n     * Converts SI → user-preferred units\n     *\n     * @param unitType - Data unitType for conversion (uses stored unitType if not provided)\n     * @returns Display value in user units, or NaN if source is NaN\n     */\n    getDisplayValue(unitType) {\n      if (Number.isNaN(this.si_value)) {\n        return NaN;\n      }\n      const category = unitType || this._unitType;\n      if (!category) {\n        return this.si_value; // No conversion\n      }\n      return require(_dependencyMap[0], \"../utils/ConversionRegistry\").ConversionRegistry.convertToDisplay(this.si_value, category);\n    }\n\n    /**\n     * Get formatted value without unit (lazy computation)\n     *\n     * @param unitType - Data unitType for formatting (uses stored unitType if not provided)\n     * @returns Formatted value (e.g., \"8.2\") or \"---\" for NaN\n     */\n    getFormattedValue(unitType) {\n      if (Number.isNaN(this.si_value)) {\n        return '---';\n      }\n      const category = unitType || this._unitType;\n      if (!category) {\n        return String(this.si_value); // No formatting\n      }\n      const displayValue = this.getDisplayValue(category);\n      return require(_dependencyMap[0], \"../utils/ConversionRegistry\").ConversionRegistry.format(displayValue, category, false, this._forceTimezone);\n    }\n\n    /**\n     * Get unit symbol (lazy computation)\n     *\n     * @param unitType - Data unitType for unit lookup (uses stored unitType if not provided)\n     * @returns Unit symbol (e.g., \"ft\", \"°C\") or empty string for NaN/no unitType\n     */\n    getUnit(unitType) {\n      if (Number.isNaN(this.si_value)) {\n        return '';\n      }\n      const category = unitType || this._unitType;\n      if (!category) {\n        return '';\n      }\n      return require(_dependencyMap[0], \"../utils/ConversionRegistry\").ConversionRegistry.getUnit(category);\n    }\n\n    /**\n     * Get formatted value with unit (lazy computation)\n     *\n     * @param unitType - Data unitType for formatting (uses stored unitType if not provided)\n     * @returns Formatted with unit (e.g., \"8.2 ft\") or \"---\" for NaN\n     */\n    getFormattedValueWithUnit(unitType) {\n      if (Number.isNaN(this.si_value)) {\n        return '---';\n      }\n      const category = unitType || this._unitType;\n      if (!category) {\n        return String(this.si_value);\n      }\n      const displayValue = this.getDisplayValue(category);\n      return require(_dependencyMap[0], \"../utils/ConversionRegistry\").ConversionRegistry.format(displayValue, category, true, this._forceTimezone);\n    }\n\n    // ============================================================================\n    // PROPERTY GETTERS (Widget API Convenience)\n    // ============================================================================\n    // Widgets expect these as properties for cleaner syntax\n\n    /**\n     * Display value (converted to user units)\n     * Convenience property getter for getDisplayValue()\n     */\n    get value() {\n      return this.getDisplayValue();\n    }\n\n    /**\n     * Formatted value WITHOUT unit\n     * Convenience property getter for getFormattedValue()\n     * Example: \"8.2\"\n     */\n    get formattedValue() {\n      return this.getFormattedValue();\n    }\n\n    /**\n     * Formatted value WITH unit\n     * Convenience property getter for getFormattedValueWithUnit()\n     * Example: \"8.2 ft\"\n     */\n    get formattedValueWithUnit() {\n      return this.getFormattedValueWithUnit();\n    }\n\n    /**\n     * Unit symbol\n     * Convenience property getter for getUnit()\n     * Example: \"ft\", \"°C\", \"%\"\n     */\n    get unit() {\n      return this.getUnit();\n    }\n\n    /**\n     * Data category/unit type\n     * Convenience property getter for getUnitType()\n     */\n    get category() {\n      return this._unitType;\n    }\n  }\n  exports.MetricValue = MetricValue;\n});","lineCount":195,"map":[[6,2,1,0],[7,0,2,0],[8,0,3,0],[9,0,4,0],[10,0,5,0],[11,0,6,0],[12,0,7,0],[13,0,8,0],[14,0,9,0],[15,0,10,0],[16,0,11,0],[17,0,12,0],[18,0,13,0],[19,0,14,0],[20,0,15,0],[21,0,16,0],[22,0,17,0],[23,0,18,0],[24,0,19,0],[25,0,20,0],[26,0,21,0],[27,0,22,0],[28,0,23,0],[29,0,24,0],[31,2,29,0],[32,0,30,0],[33,0,31,0],[34,0,32,0],[35,0,33,0],[36,0,34,0],[37,2,35,7],[37,8,35,13,"MetricValue"],[37,19,35,24],[37,20,35,25],[38,4,36,2],[40,4,39,2],[42,4,42,2],[44,4,45,2],[46,4,48,2],[47,0,49,0],[48,0,50,0],[49,0,51,0],[50,0,52,0],[51,0,53,0],[52,0,54,0],[53,0,55,0],[54,4,56,2,"constructor"],[54,15,56,13,"constructor"],[54,16,57,4,"si_value"],[54,24,57,20],[54,26,58,4,"timestamp"],[54,35,58,21],[54,38,58,24,"Date"],[54,42,58,28],[54,43,58,29,"now"],[54,46,58,32],[54,47,58,33],[54,48,58,34],[54,50,59,4,"unitType"],[54,58,59,27],[54,60,60,4,"forceTimezone"],[54,73,60,25],[54,75,61,4],[55,6,62,4],[56,6,63,4],[56,10,63,8],[56,17,63,15,"si_value"],[56,25,63,23],[56,30,63,28],[56,38,63,36],[56,40,63,38],[57,8,64,6],[57,14,64,12],[57,18,64,16,"Error"],[57,23,64,21],[57,24,64,22],[57,69,64,67],[57,76,64,74,"si_value"],[57,84,64,82],[57,86,64,84],[57,87,64,85],[58,6,65,4],[59,6,66,4],[59,10,66,8],[59,11,66,9,"Number"],[59,17,66,15],[59,18,66,16,"isNaN"],[59,23,66,21],[59,24,66,22,"si_value"],[59,32,66,30],[59,33,66,31],[59,37,66,35],[59,38,66,36,"Number"],[59,44,66,42],[59,45,66,43,"isFinite"],[59,53,66,51],[59,54,66,52,"si_value"],[59,62,66,60],[59,63,66,61],[59,65,66,63],[60,8,67,6],[60,14,67,12],[60,18,67,16,"Error"],[60,23,67,21],[60,24,67,22],[60,66,67,64],[60,67,67,65],[61,6,68,4],[62,6,70,4],[62,10,70,8],[62,11,70,9,"si_value"],[62,19,70,17],[62,22,70,20,"si_value"],[62,30,70,28],[63,6,71,4],[63,10,71,8],[63,11,71,9,"timestamp"],[63,20,71,18],[63,23,71,21,"timestamp"],[63,32,71,30],[64,6,72,4],[64,10,72,8],[64,11,72,9,"_unitType"],[64,20,72,18],[64,23,72,21,"unitType"],[64,31,72,29],[65,6,73,4],[65,10,73,8],[65,11,73,9,"_forceTimezone"],[65,25,73,23],[65,28,73,26,"forceTimezone"],[65,41,73,39],[66,4,74,2],[68,4,76,2],[69,0,77,0],[70,0,78,0],[71,4,79,2,"getUnitType"],[71,15,79,13,"getUnitType"],[71,16,79,13],[71,18,79,42],[72,6,80,4],[72,13,80,11],[72,17,80,15],[72,18,80,16,"_unitType"],[72,27,80,25],[73,4,81,2],[75,4,83,2],[76,0,84,0],[77,0,85,0],[78,0,86,0],[79,0,87,0],[80,0,88,0],[81,0,89,0],[82,4,90,2,"getDisplayValue"],[82,19,90,17,"getDisplayValue"],[82,20,90,18,"unitType"],[82,28,90,41],[82,30,90,51],[83,6,91,4],[83,10,91,8,"Number"],[83,16,91,14],[83,17,91,15,"isNaN"],[83,22,91,20],[83,23,91,21],[83,27,91,25],[83,28,91,26,"si_value"],[83,36,91,34],[83,37,91,35],[83,39,91,37],[84,8,92,6],[84,15,92,13,"NaN"],[84,18,92,16],[85,6,93,4],[86,6,94,4],[86,12,94,10,"category"],[86,20,94,18],[86,23,94,21,"unitType"],[86,31,94,29],[86,35,94,33],[86,39,94,37],[86,40,94,38,"_unitType"],[86,49,94,47],[87,6,95,4],[87,10,95,8],[87,11,95,9,"category"],[87,19,95,17],[87,21,95,19],[88,8,96,6],[88,15,96,13],[88,19,96,17],[88,20,96,18,"si_value"],[88,28,96,26],[88,29,96,27],[88,30,96,28],[89,6,97,4],[90,6,98,4],[90,13,98,11,"ConversionRegistry"],[90,39,98,11],[90,40,98,11,"ConversionRegistry"],[90,89,98,29],[90,90,98,30,"convertToDisplay"],[90,106,98,46],[90,107,98,47],[90,111,98,51],[90,112,98,52,"si_value"],[90,120,98,60],[90,122,98,62,"category"],[90,130,98,70],[90,131,98,71],[91,4,99,2],[93,4,101,2],[94,0,102,0],[95,0,103,0],[96,0,104,0],[97,0,105,0],[98,0,106,0],[99,4,107,2,"getFormattedValue"],[99,21,107,19,"getFormattedValue"],[99,22,107,20,"unitType"],[99,30,107,43],[99,32,107,53],[100,6,108,4],[100,10,108,8,"Number"],[100,16,108,14],[100,17,108,15,"isNaN"],[100,22,108,20],[100,23,108,21],[100,27,108,25],[100,28,108,26,"si_value"],[100,36,108,34],[100,37,108,35],[100,39,108,37],[101,8,109,6],[101,15,109,13],[101,20,109,18],[102,6,110,4],[103,6,111,4],[103,12,111,10,"category"],[103,20,111,18],[103,23,111,21,"unitType"],[103,31,111,29],[103,35,111,33],[103,39,111,37],[103,40,111,38,"_unitType"],[103,49,111,47],[104,6,112,4],[104,10,112,8],[104,11,112,9,"category"],[104,19,112,17],[104,21,112,19],[105,8,113,6],[105,15,113,13,"String"],[105,21,113,19],[105,22,113,20],[105,26,113,24],[105,27,113,25,"si_value"],[105,35,113,33],[105,36,113,34],[105,37,113,35],[105,38,113,36],[106,6,114,4],[107,6,115,4],[107,12,115,10,"displayValue"],[107,24,115,22],[107,27,115,25],[107,31,115,29],[107,32,115,30,"getDisplayValue"],[107,47,115,45],[107,48,115,46,"category"],[107,56,115,54],[107,57,115,55],[108,6,116,4],[108,13,116,11,"ConversionRegistry"],[108,39,116,11],[108,40,116,11,"ConversionRegistry"],[108,89,116,29],[108,90,116,30,"format"],[108,96,116,36],[108,97,116,37,"displayValue"],[108,109,116,49],[108,111,116,51,"category"],[108,119,116,59],[108,121,116,61],[108,126,116,66],[108,128,116,68],[108,132,116,72],[108,133,116,73,"_forceTimezone"],[108,147,116,87],[108,148,116,88],[109,4,117,2],[111,4,119,2],[112,0,120,0],[113,0,121,0],[114,0,122,0],[115,0,123,0],[116,0,124,0],[117,4,125,2,"getUnit"],[117,11,125,9,"getUnit"],[117,12,125,10,"unitType"],[117,20,125,33],[117,22,125,43],[118,6,126,4],[118,10,126,8,"Number"],[118,16,126,14],[118,17,126,15,"isNaN"],[118,22,126,20],[118,23,126,21],[118,27,126,25],[118,28,126,26,"si_value"],[118,36,126,34],[118,37,126,35],[118,39,126,37],[119,8,127,6],[119,15,127,13],[119,17,127,15],[120,6,128,4],[121,6,129,4],[121,12,129,10,"category"],[121,20,129,18],[121,23,129,21,"unitType"],[121,31,129,29],[121,35,129,33],[121,39,129,37],[121,40,129,38,"_unitType"],[121,49,129,47],[122,6,130,4],[122,10,130,8],[122,11,130,9,"category"],[122,19,130,17],[122,21,130,19],[123,8,131,6],[123,15,131,13],[123,17,131,15],[124,6,132,4],[125,6,133,4],[125,13,133,11,"ConversionRegistry"],[125,39,133,11],[125,40,133,11,"ConversionRegistry"],[125,89,133,29],[125,90,133,30,"getUnit"],[125,97,133,37],[125,98,133,38,"category"],[125,106,133,46],[125,107,133,47],[126,4,134,2],[128,4,136,2],[129,0,137,0],[130,0,138,0],[131,0,139,0],[132,0,140,0],[133,0,141,0],[134,4,142,2,"getFormattedValueWithUnit"],[134,29,142,27,"getFormattedValueWithUnit"],[134,30,142,28,"unitType"],[134,38,142,51],[134,40,142,61],[135,6,143,4],[135,10,143,8,"Number"],[135,16,143,14],[135,17,143,15,"isNaN"],[135,22,143,20],[135,23,143,21],[135,27,143,25],[135,28,143,26,"si_value"],[135,36,143,34],[135,37,143,35],[135,39,143,37],[136,8,144,6],[136,15,144,13],[136,20,144,18],[137,6,145,4],[138,6,146,4],[138,12,146,10,"category"],[138,20,146,18],[138,23,146,21,"unitType"],[138,31,146,29],[138,35,146,33],[138,39,146,37],[138,40,146,38,"_unitType"],[138,49,146,47],[139,6,147,4],[139,10,147,8],[139,11,147,9,"category"],[139,19,147,17],[139,21,147,19],[140,8,148,6],[140,15,148,13,"String"],[140,21,148,19],[140,22,148,20],[140,26,148,24],[140,27,148,25,"si_value"],[140,35,148,33],[140,36,148,34],[141,6,149,4],[142,6,150,4],[142,12,150,10,"displayValue"],[142,24,150,22],[142,27,150,25],[142,31,150,29],[142,32,150,30,"getDisplayValue"],[142,47,150,45],[142,48,150,46,"category"],[142,56,150,54],[142,57,150,55],[143,6,151,4],[143,13,151,11,"ConversionRegistry"],[143,39,151,11],[143,40,151,11,"ConversionRegistry"],[143,89,151,29],[143,90,151,30,"format"],[143,96,151,36],[143,97,151,37,"displayValue"],[143,109,151,49],[143,111,151,51,"category"],[143,119,151,59],[143,121,151,61],[143,125,151,65],[143,127,151,67],[143,131,151,71],[143,132,151,72,"_forceTimezone"],[143,146,151,86],[143,147,151,87],[144,4,152,2],[146,4,154,2],[147,4,155,2],[148,4,156,2],[149,4,157,2],[151,4,159,2],[152,0,160,0],[153,0,161,0],[154,0,162,0],[155,4,163,2],[155,8,163,6,"value"],[155,13,163,11,"value"],[155,14,163,11],[155,16,163,22],[156,6,164,4],[156,13,164,11],[156,17,164,15],[156,18,164,16,"getDisplayValue"],[156,33,164,31],[156,34,164,32],[156,35,164,33],[157,4,165,2],[159,4,167,2],[160,0,168,0],[161,0,169,0],[162,0,170,0],[163,0,171,0],[164,4,172,2],[164,8,172,6,"formattedValue"],[164,22,172,20,"formattedValue"],[164,23,172,20],[164,25,172,31],[165,6,173,4],[165,13,173,11],[165,17,173,15],[165,18,173,16,"getFormattedValue"],[165,35,173,33],[165,36,173,34],[165,37,173,35],[166,4,174,2],[168,4,176,2],[169,0,177,0],[170,0,178,0],[171,0,179,0],[172,0,180,0],[173,4,181,2],[173,8,181,6,"formattedValueWithUnit"],[173,30,181,28,"formattedValueWithUnit"],[173,31,181,28],[173,33,181,39],[174,6,182,4],[174,13,182,11],[174,17,182,15],[174,18,182,16,"getFormattedValueWithUnit"],[174,43,182,41],[174,44,182,42],[174,45,182,43],[175,4,183,2],[177,4,185,2],[178,0,186,0],[179,0,187,0],[180,0,188,0],[181,0,189,0],[182,4,190,2],[182,8,190,6,"unit"],[182,12,190,10,"unit"],[182,13,190,10],[182,15,190,21],[183,6,191,4],[183,13,191,11],[183,17,191,15],[183,18,191,16,"getUnit"],[183,25,191,23],[183,26,191,24],[183,27,191,25],[184,4,192,2],[186,4,194,2],[187,0,195,0],[188,0,196,0],[189,0,197,0],[190,4,198,2],[190,8,198,6,"category"],[190,16,198,14,"category"],[190,17,198,14],[190,19,198,43],[191,6,199,4],[191,13,199,11],[191,17,199,15],[191,18,199,16,"_unitType"],[191,27,199,25],[192,4,200,2],[193,2,201,0],[194,2,201,1,"exports"],[194,9,201,1],[194,10,201,1,"MetricValue"],[194,21,201,1],[194,24,201,1,"MetricValue"],[194,35,201,1],[195,0,201,1],[195,3]],"functionMap":{"names":["<global>","MetricValue","constructor","getUnitType","getDisplayValue","getFormattedValue","getUnit","getFormattedValueWithUnit","get__value","get__formattedValue","get__formattedValueWithUnit","get__unit","get__category"],"mappings":"AAA;OCkC;ECqB;GDkB;EEK;GFE;EGS;GHS;EIQ;GJU;EKQ;GLS;EMQ;GNU;EOW;GPE;EQO;GRE;ESO;GTE;EUO;GVE;EWM;GXE;CDC"}},"type":"js/module"}]}