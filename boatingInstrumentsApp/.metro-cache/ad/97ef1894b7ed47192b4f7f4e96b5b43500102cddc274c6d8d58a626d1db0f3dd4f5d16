{"dependencies":[{"name":"./logging/logger","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":41,"column":0,"index":1290},"end":{"line":41,"column":39,"index":1329}},{"start":{"line":41,"column":0,"index":1290},"end":{"line":41,"column":39,"index":1329}},{"start":{"line":41,"column":0,"index":1290},"end":{"line":41,"column":39,"index":1329}},{"start":{"line":41,"column":0,"index":1290},"end":{"line":41,"column":39,"index":1329}},{"start":{"line":41,"column":0,"index":1290},"end":{"line":41,"column":39,"index":1329}},{"start":{"line":41,"column":0,"index":1290},"end":{"line":41,"column":39,"index":1329}}],"key":"AG5tn3FQlAEVwMz6R1Rqy2CuHrs=","exportNames":["*"],"imports":6}},{"name":"../presentation/presentationStore","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":40,"column":0,"index":1216},"end":{"line":40,"column":73,"index":1289}}],"key":"BamEkPJVRrxYlxmHCpwPFKoMCe8=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  Object.defineProperty(exports, \"__esModule\", {\n    value: true\n  });\n  exports.ReEnrichmentCoordinator = void 0;\n  /**\n   * ReEnrichmentCoordinator - Global Re-Enrichment Manager\n   *\n   * **Purpose:**\n   * Coordinates re-enrichment across all sensor instances when presentation\n   * preferences change. Debounces re-enrichment to prevent performance issues\n   * during rapid preference changes.\n   *\n   * **Architecture:**\n   * - Singleton service\n   * - Registers sensor instances for coordinated updates\n   * - Single debounce timer for all sensors (not per-sensor)\n   * - Subscribes to presentation store changes\n   * - Batch re-enrichment for efficiency\n   *\n   * **Usage:**\n   * ```typescript\n   * // Initialize once at app startup\n   * ReEnrichmentCoordinator.initialize();\n   *\n   * // Register sensor instances (done by nmeaStore)\n   * ReEnrichmentCoordinator.register(sensorInstance);\n   *\n   * // Unregister on cleanup\n   * ReEnrichmentCoordinator.unregister(sensorInstance);\n   *\n   * // Manual trigger (usually automatic via subscription)\n   * ReEnrichmentCoordinator.triggerReEnrichment();\n   * ```\n   *\n   * **Benefits:**\n   * - ✅ Single debounce timer (efficient)\n   * - ✅ Batch re-enrichment (all sensors at once)\n   * - ✅ Automatic on presentation changes\n   * - ✅ Performance logging\n   * - ✅ Clean instance management\n   */\n\n  /**\n   * Re-Enrichment Coordinator Service\n   * Singleton managing global re-enrichment\n   */\n  class ReEnrichmentCoordinatorService {\n    instances = new Set();\n    DEBOUNCE_MS = 100;\n    /**\n     * Register sensor instance for coordinated re-enrichment\n     * Called by nmeaStore when creating new sensor instances\n     *\n     * @param instance - Sensor instance to register\n     */\n    register(instance) {\n      this.instances.add(instance);\n      require(_dependencyMap[0], \"./logging/logger\").log.app('Sensor instance registered for re-enrichment', () => ({\n        type: instance.type,\n        instance: instance.instance,\n        totalInstances: this.instances.size\n      }));\n    }\n\n    /**\n     * Unregister sensor instance\n     * Called during cleanup or factory reset\n     *\n     * @param instance - Sensor instance to unregister\n     */\n    unregister(instance) {\n      this.instances.delete(instance);\n      require(_dependencyMap[0], \"./logging/logger\").log.app('Sensor instance unregistered from re-enrichment', () => ({\n        type: instance.type,\n        instance: instance.instance,\n        totalInstances: this.instances.size\n      }));\n    }\n\n    /**\n     * Trigger re-enrichment (debounced)\n     * Called automatically when presentation preferences change\n     *\n     * Debounces to prevent excessive re-enrichment during rapid changes\n     * (e.g., user scrolling through unit preferences)\n     */\n    triggerReEnrichment() {\n      if (this.debounceTimer) {\n        clearTimeout(this.debounceTimer);\n      }\n      this.debounceTimer = setTimeout(() => {\n        const startTime = Date.now();\n\n        // Batch re-enrich all sensor instances\n        for (const instance of this.instances) {\n          instance.reEnrich();\n        }\n        const duration = Date.now() - startTime;\n        require(_dependencyMap[0], \"./logging/logger\").log.app('Global re-enrichment complete', () => ({\n          instanceCount: this.instances.size,\n          durationMs: duration,\n          avgPerInstance: this.instances.size > 0 ? duration / this.instances.size : 0\n        }));\n      }, this.DEBOUNCE_MS);\n    }\n\n    /**\n     * Initialize subscription to presentation changes\n     * Call once at app startup\n     *\n     * @example\n     * // In App.tsx or index.js\n     * ReEnrichmentCoordinator.initialize();\n     */\n    initialize() {\n      if (this.unsubscribe) {\n        // Already initialized\n        return;\n      }\n      this.unsubscribe = require(_dependencyMap[1], \"../presentation/presentationStore\").usePresentationStore.subscribe((state, prevState) => {\n        if (state.selectedPresentations !== prevState.selectedPresentations) {\n          require(_dependencyMap[0], \"./logging/logger\").log.app('Presentation change detected, triggering re-enrichment');\n          this.triggerReEnrichment();\n        }\n      });\n      require(_dependencyMap[0], \"./logging/logger\").log.app('ReEnrichmentCoordinator initialized');\n    }\n\n    /**\n     * Cleanup (for testing or shutdown)\n     */\n    destroy() {\n      if (this.debounceTimer) {\n        clearTimeout(this.debounceTimer);\n        this.debounceTimer = undefined;\n      }\n      if (this.unsubscribe) {\n        this.unsubscribe();\n        this.unsubscribe = undefined;\n      }\n      this.instances.clear();\n      require(_dependencyMap[0], \"./logging/logger\").log.app('ReEnrichmentCoordinator destroyed');\n    }\n\n    /**\n     * Get coordinator statistics (for debugging)\n     */\n    getStats() {\n      return {\n        registeredInstances: this.instances.size,\n        isInitialized: !!this.unsubscribe\n      };\n    }\n  }\n\n  /**\n   * Singleton instance\n   * Import and use this in your application\n   */\n  const ReEnrichmentCoordinator = exports.ReEnrichmentCoordinator = new ReEnrichmentCoordinatorService();\n});","lineCount":162,"map":[[6,2,1,0],[7,0,2,0],[8,0,3,0],[9,0,4,0],[10,0,5,0],[11,0,6,0],[12,0,7,0],[13,0,8,0],[14,0,9,0],[15,0,10,0],[16,0,11,0],[17,0,12,0],[18,0,13,0],[19,0,14,0],[20,0,15,0],[21,0,16,0],[22,0,17,0],[23,0,18,0],[24,0,19,0],[25,0,20,0],[26,0,21,0],[27,0,22,0],[28,0,23,0],[29,0,24,0],[30,0,25,0],[31,0,26,0],[32,0,27,0],[33,0,28,0],[34,0,29,0],[35,0,30,0],[36,0,31,0],[37,0,32,0],[38,0,33,0],[39,0,34,0],[40,0,35,0],[41,0,36,0],[42,0,37,0],[44,2,43,0],[45,0,44,0],[46,0,45,0],[47,0,46,0],[48,2,47,0],[48,8,47,6,"ReEnrichmentCoordinatorService"],[48,38,47,36],[48,39,47,37],[49,4,48,10,"instances"],[49,13,48,19],[49,16,48,48],[49,20,48,52,"Set"],[49,23,48,55],[49,24,48,56],[49,25,48,57],[50,4,50,19,"DEBOUNCE_MS"],[50,15,50,30],[50,18,50,33],[50,21,50,36],[51,4,53,2],[52,0,54,0],[53,0,55,0],[54,0,56,0],[55,0,57,0],[56,0,58,0],[57,4,59,2,"register"],[57,12,59,10,"register"],[57,13,59,11,"instance"],[57,21,59,40],[57,23,59,48],[58,6,60,4],[58,10,60,8],[58,11,60,9,"instances"],[58,20,60,18],[58,21,60,19,"add"],[58,24,60,22],[58,25,60,23,"instance"],[58,33,60,31],[58,34,60,32],[59,6,62,4,"log"],[59,32,62,4],[59,33,62,4,"log"],[59,56,62,7],[59,57,62,8,"app"],[59,60,62,11],[59,61,62,12],[59,107,62,58],[59,109,62,60],[59,116,62,67],[60,8,63,6,"type"],[60,12,63,10],[60,14,63,12,"instance"],[60,22,63,20],[60,23,63,21,"type"],[60,27,63,25],[61,8,64,6,"instance"],[61,16,64,14],[61,18,64,16,"instance"],[61,26,64,24],[61,27,64,25,"instance"],[61,35,64,33],[62,8,65,6,"totalInstances"],[62,22,65,20],[62,24,65,22],[62,28,65,26],[62,29,65,27,"instances"],[62,38,65,36],[62,39,65,37,"size"],[63,6,66,4],[63,7,66,5],[63,8,66,6],[63,9,66,7],[64,4,67,2],[66,4,69,2],[67,0,70,0],[68,0,71,0],[69,0,72,0],[70,0,73,0],[71,0,74,0],[72,4,75,2,"unregister"],[72,14,75,12,"unregister"],[72,15,75,13,"instance"],[72,23,75,42],[72,25,75,50],[73,6,76,4],[73,10,76,8],[73,11,76,9,"instances"],[73,20,76,18],[73,21,76,19,"delete"],[73,27,76,25],[73,28,76,26,"instance"],[73,36,76,34],[73,37,76,35],[74,6,78,4,"log"],[74,32,78,4],[74,33,78,4,"log"],[74,56,78,7],[74,57,78,8,"app"],[74,60,78,11],[74,61,78,12],[74,110,78,61],[74,112,78,63],[74,119,78,70],[75,8,79,6,"type"],[75,12,79,10],[75,14,79,12,"instance"],[75,22,79,20],[75,23,79,21,"type"],[75,27,79,25],[76,8,80,6,"instance"],[76,16,80,14],[76,18,80,16,"instance"],[76,26,80,24],[76,27,80,25,"instance"],[76,35,80,33],[77,8,81,6,"totalInstances"],[77,22,81,20],[77,24,81,22],[77,28,81,26],[77,29,81,27,"instances"],[77,38,81,36],[77,39,81,37,"size"],[78,6,82,4],[78,7,82,5],[78,8,82,6],[78,9,82,7],[79,4,83,2],[81,4,85,2],[82,0,86,0],[83,0,87,0],[84,0,88,0],[85,0,89,0],[86,0,90,0],[87,0,91,0],[88,4,92,2,"triggerReEnrichment"],[88,23,92,21,"triggerReEnrichment"],[88,24,92,21],[88,26,92,30],[89,6,93,4],[89,10,93,8],[89,14,93,12],[89,15,93,13,"debounceTimer"],[89,28,93,26],[89,30,93,28],[90,8,94,6,"clearTimeout"],[90,20,94,18],[90,21,94,19],[90,25,94,23],[90,26,94,24,"debounceTimer"],[90,39,94,37],[90,40,94,38],[91,6,95,4],[92,6,97,4],[92,10,97,8],[92,11,97,9,"debounceTimer"],[92,24,97,22],[92,27,97,25,"setTimeout"],[92,37,97,35],[92,38,97,36],[92,44,97,42],[93,8,98,6],[93,14,98,12,"startTime"],[93,23,98,21],[93,26,98,24,"Date"],[93,30,98,28],[93,31,98,29,"now"],[93,34,98,32],[93,35,98,33],[93,36,98,34],[95,8,100,6],[96,8,101,6],[96,13,101,11],[96,19,101,17,"instance"],[96,27,101,25],[96,31,101,29],[96,35,101,33],[96,36,101,34,"instances"],[96,45,101,43],[96,47,101,45],[97,10,102,8,"instance"],[97,18,102,16],[97,19,102,17,"reEnrich"],[97,27,102,25],[97,28,102,26],[97,29,102,27],[98,8,103,6],[99,8,105,6],[99,14,105,12,"duration"],[99,22,105,20],[99,25,105,23,"Date"],[99,29,105,27],[99,30,105,28,"now"],[99,33,105,31],[99,34,105,32],[99,35,105,33],[99,38,105,36,"startTime"],[99,47,105,45],[100,8,107,6,"log"],[100,34,107,6],[100,35,107,6,"log"],[100,58,107,9],[100,59,107,10,"app"],[100,62,107,13],[100,63,107,14],[100,94,107,45],[100,96,107,47],[100,103,107,54],[101,10,108,8,"instanceCount"],[101,23,108,21],[101,25,108,23],[101,29,108,27],[101,30,108,28,"instances"],[101,39,108,37],[101,40,108,38,"size"],[101,44,108,42],[102,10,109,8,"durationMs"],[102,20,109,18],[102,22,109,20,"duration"],[102,30,109,28],[103,10,110,8,"avgPerInstance"],[103,24,110,22],[103,26,110,24],[103,30,110,28],[103,31,110,29,"instances"],[103,40,110,38],[103,41,110,39,"size"],[103,45,110,43],[103,48,110,46],[103,49,110,47],[103,52,110,50,"duration"],[103,60,110,58],[103,63,110,61],[103,67,110,65],[103,68,110,66,"instances"],[103,77,110,75],[103,78,110,76,"size"],[103,82,110,80],[103,85,110,83],[104,8,111,6],[104,9,111,7],[104,10,111,8],[104,11,111,9],[105,6,112,4],[105,7,112,5],[105,9,112,7],[105,13,112,11],[105,14,112,12,"DEBOUNCE_MS"],[105,25,112,23],[105,26,112,24],[106,4,113,2],[108,4,115,2],[109,0,116,0],[110,0,117,0],[111,0,118,0],[112,0,119,0],[113,0,120,0],[114,0,121,0],[115,0,122,0],[116,4,123,2,"initialize"],[116,14,123,12,"initialize"],[116,15,123,12],[116,17,123,21],[117,6,124,4],[117,10,124,8],[117,14,124,12],[117,15,124,13,"unsubscribe"],[117,26,124,24],[117,28,124,26],[118,8,125,6],[119,8,126,6],[120,6,127,4],[121,6,129,4],[121,10,129,8],[121,11,129,9,"unsubscribe"],[121,22,129,20],[121,25,129,23,"usePresentationStore"],[121,51,129,23],[121,52,129,23,"usePresentationStore"],[121,109,129,43],[121,110,129,44,"subscribe"],[121,119,129,53],[121,120,129,54],[121,121,129,55,"state"],[121,126,129,60],[121,128,129,62,"prevState"],[121,137,129,71],[121,142,129,76],[122,8,130,6],[122,12,130,10,"state"],[122,17,130,15],[122,18,130,16,"selectedPresentations"],[122,39,130,37],[122,44,130,42,"prevState"],[122,53,130,51],[122,54,130,52,"selectedPresentations"],[122,75,130,73],[122,77,130,75],[123,10,131,8,"log"],[123,36,131,8],[123,37,131,8,"log"],[123,60,131,11],[123,61,131,12,"app"],[123,64,131,15],[123,65,131,16],[123,121,131,72],[123,122,131,73],[124,10,132,8],[124,14,132,12],[124,15,132,13,"triggerReEnrichment"],[124,34,132,32],[124,35,132,33],[124,36,132,34],[125,8,133,6],[126,6,134,4],[126,7,134,5],[126,8,134,6],[127,6,136,4,"log"],[127,32,136,4],[127,33,136,4,"log"],[127,56,136,7],[127,57,136,8,"app"],[127,60,136,11],[127,61,136,12],[127,98,136,49],[127,99,136,50],[128,4,137,2],[130,4,139,2],[131,0,140,0],[132,0,141,0],[133,4,142,2,"destroy"],[133,11,142,9,"destroy"],[133,12,142,9],[133,14,142,18],[134,6,143,4],[134,10,143,8],[134,14,143,12],[134,15,143,13,"debounceTimer"],[134,28,143,26],[134,30,143,28],[135,8,144,6,"clearTimeout"],[135,20,144,18],[135,21,144,19],[135,25,144,23],[135,26,144,24,"debounceTimer"],[135,39,144,37],[135,40,144,38],[136,8,145,6],[136,12,145,10],[136,13,145,11,"debounceTimer"],[136,26,145,24],[136,29,145,27,"undefined"],[136,38,145,36],[137,6,146,4],[138,6,148,4],[138,10,148,8],[138,14,148,12],[138,15,148,13,"unsubscribe"],[138,26,148,24],[138,28,148,26],[139,8,149,6],[139,12,149,10],[139,13,149,11,"unsubscribe"],[139,24,149,22],[139,25,149,23],[139,26,149,24],[140,8,150,6],[140,12,150,10],[140,13,150,11,"unsubscribe"],[140,24,150,22],[140,27,150,25,"undefined"],[140,36,150,34],[141,6,151,4],[142,6,153,4],[142,10,153,8],[142,11,153,9,"instances"],[142,20,153,18],[142,21,153,19,"clear"],[142,26,153,24],[142,27,153,25],[142,28,153,26],[143,6,155,4,"log"],[143,32,155,4],[143,33,155,4,"log"],[143,56,155,7],[143,57,155,8,"app"],[143,60,155,11],[143,61,155,12],[143,96,155,47],[143,97,155,48],[144,4,156,2],[146,4,158,2],[147,0,159,0],[148,0,160,0],[149,4,161,2,"getStats"],[149,12,161,10,"getStats"],[149,13,161,10],[149,15,161,70],[150,6,162,4],[150,13,162,11],[151,8,163,6,"registeredInstances"],[151,27,163,25],[151,29,163,27],[151,33,163,31],[151,34,163,32,"instances"],[151,43,163,41],[151,44,163,42,"size"],[151,48,163,46],[152,8,164,6,"isInitialized"],[152,21,164,19],[152,23,164,21],[152,24,164,22],[152,25,164,23],[152,29,164,27],[152,30,164,28,"unsubscribe"],[153,6,165,4],[153,7,165,5],[154,4,166,2],[155,2,167,0],[157,2,169,0],[158,0,170,0],[159,0,171,0],[160,0,172,0],[161,2,173,7],[161,8,173,13,"ReEnrichmentCoordinator"],[161,31,173,36],[161,34,173,36,"exports"],[161,41,173,36],[161,42,173,36,"ReEnrichmentCoordinator"],[161,65,173,36],[161,68,173,39],[161,72,173,43,"ReEnrichmentCoordinatorService"],[161,102,173,73],[161,103,173,74],[161,104,173,75],[162,0,173,76],[162,3]],"functionMap":{"names":["<global>","ReEnrichmentCoordinatorService","ReEnrichmentCoordinatorService#register","log.app$argument_1","ReEnrichmentCoordinatorService#unregister","ReEnrichmentCoordinatorService#triggerReEnrichment","setTimeout$argument_0","ReEnrichmentCoordinatorService#initialize","usePresentationStore.subscribe$argument_0","ReEnrichmentCoordinatorService#destroy","ReEnrichmentCoordinatorService#getStats"],"mappings":"AAA;AC8C;ECY;4DCG;MDI;GDC;EGQ;+DDG;MCI;GHC;EIS;oCCK;+CHU;QGI;KDC;GJC;EMU;sDCM;KDK;GNG;EQK;GRc;ESK;GTK;CDC"}},"type":"js/module"}]}