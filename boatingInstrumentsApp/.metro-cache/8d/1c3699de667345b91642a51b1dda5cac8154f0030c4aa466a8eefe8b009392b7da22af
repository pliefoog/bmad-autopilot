{"dependencies":[{"name":"@babel/runtime/helpers/interopRequireDefault","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"kslwqCIsh6ew+I1KeA1rlVRjsAk=","exportNames":["*"],"imports":1}},{"name":"@babel/runtime/helpers/classCallCheck","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"yg7e6laZwmpbIvId5jovq9ugXp8=","exportNames":["*"],"imports":1}},{"name":"@babel/runtime/helpers/createClass","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"Z6pzkVZ2fvxBLkFTgVVOy4UDj30=","exportNames":["*"],"imports":1}},{"name":"invariant","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":13,"column":18},"end":{"line":13,"column":38}}],"key":"oQpL0Es3H146KnQH9ygFeHrzVP4=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  'use strict';\n\n  var _interopRequireDefault = require(_dependencyMap[0], \"@babel/runtime/helpers/interopRequireDefault\").default;\n  Object.defineProperty(exports, \"__esModule\", {\n    value: true\n  });\n  exports.default = void 0;\n  var _classCallCheck2 = _interopRequireDefault(require(_dependencyMap[1], \"@babel/runtime/helpers/classCallCheck\"));\n  var _createClass2 = _interopRequireDefault(require(_dependencyMap[2], \"@babel/runtime/helpers/createClass\"));\n  var DEBUG = false;\n  var TaskQueue = /*#__PURE__*/function () {\n    function TaskQueue(_ref) {\n      var onMoreTasks = _ref.onMoreTasks;\n      (0, _classCallCheck2.default)(this, TaskQueue);\n      this._onMoreTasks = onMoreTasks;\n      this._queueStack = [{\n        tasks: [],\n        popable: false\n      }];\n    }\n    return (0, _createClass2.default)(TaskQueue, [{\n      key: \"enqueue\",\n      value: function enqueue(task) {\n        this._getCurrentQueue().push(task);\n      }\n    }, {\n      key: \"enqueueTasks\",\n      value: function enqueueTasks(tasks) {\n        tasks.forEach(task => this.enqueue(task));\n      }\n    }, {\n      key: \"cancelTasks\",\n      value: function cancelTasks(tasksToCancel) {\n        this._queueStack = this._queueStack.map(queue => ({\n          ...queue,\n          tasks: queue.tasks.filter(task => tasksToCancel.indexOf(task) === -1)\n        })).filter((queue, idx) => queue.tasks.length > 0 || idx === 0);\n      }\n    }, {\n      key: \"hasTasksToProcess\",\n      value: function hasTasksToProcess() {\n        return this._getCurrentQueue().length > 0;\n      }\n    }, {\n      key: \"processNext\",\n      value: function processNext() {\n        var queue = this._getCurrentQueue();\n        if (queue.length) {\n          var task = queue.shift();\n          try {\n            if (typeof task === 'object' && task.gen) {\n              DEBUG && console.log('TaskQueue: genPromise for task ' + task.name);\n              this._genPromise(task);\n            } else if (typeof task === 'object' && task.run) {\n              DEBUG && console.log('TaskQueue: run task ' + task.name);\n              task.run();\n            } else {\n              require(_dependencyMap[3], \"invariant\")(typeof task === 'function', 'Expected Function, SimpleTask, or PromiseTask, but got:\\n' + JSON.stringify(task, null, 2));\n              DEBUG && console.log('TaskQueue: run anonymous task');\n              task();\n            }\n          } catch (e) {\n            e.message = 'TaskQueue: Error with task ' + (task.name || '') + ': ' + e.message;\n            throw e;\n          }\n        }\n      }\n    }, {\n      key: \"_getCurrentQueue\",\n      value: function _getCurrentQueue() {\n        var stackIdx = this._queueStack.length - 1;\n        var queue = this._queueStack[stackIdx];\n        if (queue.popable && queue.tasks.length === 0 && this._queueStack.length > 1) {\n          this._queueStack.pop();\n          DEBUG && console.log('TaskQueue: popped queue: ', {\n            stackIdx,\n            queueStackSize: this._queueStack.length\n          });\n          return this._getCurrentQueue();\n        } else {\n          return queue.tasks;\n        }\n      }\n    }, {\n      key: \"_genPromise\",\n      value: function _genPromise(task) {\n        this._queueStack.push({\n          tasks: [],\n          popable: false\n        });\n        var stackIdx = this._queueStack.length - 1;\n        var stackItem = this._queueStack[stackIdx];\n        DEBUG && console.log('TaskQueue: push new queue: ', {\n          stackIdx\n        });\n        DEBUG && console.log('TaskQueue: exec gen task ' + task.name);\n        task.gen().then(() => {\n          DEBUG && console.log('TaskQueue: onThen for gen task ' + task.name, {\n            stackIdx,\n            queueStackSize: this._queueStack.length\n          });\n          stackItem.popable = true;\n          this.hasTasksToProcess() && this._onMoreTasks();\n        }).catch(ex => {\n          setTimeout(() => {\n            ex.message = `TaskQueue: Error resolving Promise in task ${task.name}: ${ex.message}`;\n            throw ex;\n          }, 0);\n        });\n      }\n    }]);\n  }();\n  var _default = exports.default = TaskQueue;\n});","lineCount":115,"map":[[2,2,11,0],[2,14,11,12],[4,2,11,13],[4,6,11,13,"_interopRequireDefault"],[4,28,11,13],[4,31,11,13,"require"],[4,38,11,13],[4,39,11,13,"_dependencyMap"],[4,53,11,13],[4,106,11,13,"default"],[4,113,11,13],[5,2,11,13,"Object"],[5,8,11,13],[5,9,11,13,"defineProperty"],[5,23,11,13],[5,24,11,13,"exports"],[5,31,11,13],[6,4,11,13,"value"],[6,9,11,13],[7,2,11,13],[8,2,11,13,"exports"],[8,9,11,13],[8,10,11,13,"default"],[8,17,11,13],[9,2,11,13],[9,6,11,13,"_classCallCheck2"],[9,22,11,13],[9,25,11,13,"_interopRequireDefault"],[9,47,11,13],[9,48,11,13,"require"],[9,55,11,13],[9,56,11,13,"_dependencyMap"],[9,70,11,13],[10,2,11,13],[10,6,11,13,"_createClass2"],[10,19,11,13],[10,22,11,13,"_interopRequireDefault"],[10,44,11,13],[10,45,11,13,"require"],[10,52,11,13],[10,53,11,13,"_dependencyMap"],[10,67,11,13],[11,2,25,0],[11,6,25,6,"DEBUG"],[11,11,25,18],[11,14,25,21],[11,19,25,26],[12,2,25,27],[12,6,43,6,"TaskQueue"],[12,15,43,15],[13,4,51,2],[13,13,51,2,"TaskQueue"],[13,23,51,2,"_ref"],[13,27,51,2],[13,29,51,61],[14,6,51,61],[14,10,51,15,"onMoreTasks"],[14,21,51,26],[14,24,51,26,"_ref"],[14,28,51,26],[14,29,51,15,"onMoreTasks"],[14,40,51,26],[15,6,51,26],[15,10,51,26,"_classCallCheck2"],[15,26,51,26],[15,27,51,26,"default"],[15,34,51,26],[15,42,51,26,"TaskQueue"],[15,51,51,26],[16,6,52,4],[16,10,52,8],[16,11,52,9,"_onMoreTasks"],[16,23,52,21],[16,26,52,24,"onMoreTasks"],[16,37,52,35],[17,6,53,4],[17,10,53,8],[17,11,53,9,"_queueStack"],[17,22,53,20],[17,25,53,23],[17,26,53,24],[18,8,53,25,"tasks"],[18,13,53,30],[18,15,53,32],[18,17,53,34],[19,8,53,36,"popable"],[19,15,53,43],[19,17,53,45],[20,6,53,50],[20,7,53,51],[20,8,53,52],[21,4,54,2],[22,4,54,3],[22,15,54,3,"_createClass2"],[22,28,54,3],[22,29,54,3,"default"],[22,36,54,3],[22,38,54,3,"TaskQueue"],[22,47,54,3],[23,6,54,3,"key"],[23,9,54,3],[24,6,54,3,"value"],[24,11,54,3],[24,13,61,2],[24,22,61,2,"enqueue"],[24,29,61,9,"enqueue"],[24,30,61,10,"task"],[24,34,61,20],[24,36,61,28],[25,8,62,4],[25,12,62,8],[25,13,62,9,"_getCurrentQueue"],[25,29,62,25],[25,30,62,26],[25,31,62,27],[25,32,62,28,"push"],[25,36,62,32],[25,37,62,33,"task"],[25,41,62,37],[25,42,62,38],[26,6,63,2],[27,4,63,3],[28,6,63,3,"key"],[28,9,63,3],[29,6,63,3,"value"],[29,11,63,3],[29,13,65,2],[29,22,65,2,"enqueueTasks"],[29,34,65,14,"enqueueTasks"],[29,35,65,15,"tasks"],[29,40,65,33],[29,42,65,41],[30,8,66,4,"tasks"],[30,13,66,9],[30,14,66,10,"forEach"],[30,21,66,17],[30,22,66,18,"task"],[30,26,66,22],[30,30,66,26],[30,34,66,30],[30,35,66,31,"enqueue"],[30,42,66,38],[30,43,66,39,"task"],[30,47,66,43],[30,48,66,44],[30,49,66,45],[31,6,67,2],[32,4,67,3],[33,6,67,3,"key"],[33,9,67,3],[34,6,67,3,"value"],[34,11,67,3],[34,13,69,2],[34,22,69,2,"cancelTasks"],[34,33,69,13,"cancelTasks"],[34,34,69,14,"tasksToCancel"],[34,47,69,40],[34,49,69,48],[35,8,71,4],[35,12,71,8],[35,13,71,9,"_queueStack"],[35,24,71,20],[35,27,71,23],[35,31,71,27],[35,32,71,28,"_queueStack"],[35,43,71,39],[35,44,72,7,"map"],[35,47,72,10],[35,48,72,11,"queue"],[35,53,72,16],[35,58,72,21],[36,10,73,8],[36,13,73,11,"queue"],[36,18,73,16],[37,10,74,8,"tasks"],[37,15,74,13],[37,17,74,15,"queue"],[37,22,74,20],[37,23,74,21,"tasks"],[37,28,74,26],[37,29,74,27,"filter"],[37,35,74,33],[37,36,74,34,"task"],[37,40,74,38],[37,44,74,42,"tasksToCancel"],[37,57,74,55],[37,58,74,56,"indexOf"],[37,65,74,63],[37,66,74,64,"task"],[37,70,74,68],[37,71,74,69],[37,76,74,74],[37,77,74,75],[37,78,74,76],[38,8,75,6],[38,9,75,7],[38,10,75,8],[38,11,75,9],[38,12,76,7,"filter"],[38,18,76,13],[38,19,76,14],[38,20,76,15,"queue"],[38,25,76,20],[38,27,76,22,"idx"],[38,30,76,25],[38,35,76,30,"queue"],[38,40,76,35],[38,41,76,36,"tasks"],[38,46,76,41],[38,47,76,42,"length"],[38,53,76,48],[38,56,76,51],[38,57,76,52],[38,61,76,56,"idx"],[38,64,76,59],[38,69,76,64],[38,70,76,65],[38,71,76,66],[39,6,77,2],[40,4,77,3],[41,6,77,3,"key"],[41,9,77,3],[42,6,77,3,"value"],[42,11,77,3],[42,13,89,2],[42,22,89,2,"hasTasksToProcess"],[42,39,89,19,"hasTasksToProcess"],[42,40,89,19],[42,42,89,31],[43,8,90,4],[43,15,90,11],[43,19,90,15],[43,20,90,16,"_getCurrentQueue"],[43,36,90,32],[43,37,90,33],[43,38,90,34],[43,39,90,35,"length"],[43,45,90,41],[43,48,90,44],[43,49,90,45],[44,6,91,2],[45,4,91,3],[46,6,91,3,"key"],[46,9,91,3],[47,6,91,3,"value"],[47,11,91,3],[47,13,96,2],[47,22,96,2,"processNext"],[47,33,96,13,"processNext"],[47,34,96,13],[47,36,96,22],[48,8,97,4],[48,12,97,10,"queue"],[48,17,97,15],[48,20,97,18],[48,24,97,22],[48,25,97,23,"_getCurrentQueue"],[48,41,97,39],[48,42,97,40],[48,43,97,41],[49,8,98,4],[49,12,98,8,"queue"],[49,17,98,13],[49,18,98,14,"length"],[49,24,98,20],[49,26,98,22],[50,10,99,6],[50,14,99,12,"task"],[50,18,99,16],[50,21,99,19,"queue"],[50,26,99,24],[50,27,99,25,"shift"],[50,32,99,30],[50,33,99,31],[50,34,99,32],[51,10,100,6],[51,14,100,10],[52,12,101,8],[52,16,101,12],[52,23,101,19,"task"],[52,27,101,23],[52,32,101,28],[52,40,101,36],[52,44,101,40,"task"],[52,48,101,44],[52,49,101,45,"gen"],[52,52,101,48],[52,54,101,50],[53,14,102,10,"DEBUG"],[53,19,102,15],[53,23,102,19,"console"],[53,30,102,26],[53,31,102,27,"log"],[53,34,102,30],[53,35,102,31],[53,68,102,64],[53,71,102,67,"task"],[53,75,102,71],[53,76,102,72,"name"],[53,80,102,76],[53,81,102,77],[54,14,103,10],[54,18,103,14],[54,19,103,15,"_genPromise"],[54,30,103,26],[54,31,103,27,"task"],[54,35,103,31],[54,36,103,32],[55,12,104,8],[55,13,104,9],[55,19,104,15],[55,23,104,19],[55,30,104,26,"task"],[55,34,104,30],[55,39,104,35],[55,47,104,43],[55,51,104,47,"task"],[55,55,104,51],[55,56,104,52,"run"],[55,59,104,55],[55,61,104,57],[56,14,105,10,"DEBUG"],[56,19,105,15],[56,23,105,19,"console"],[56,30,105,26],[56,31,105,27,"log"],[56,34,105,30],[56,35,105,31],[56,57,105,53],[56,60,105,56,"task"],[56,64,105,60],[56,65,105,61,"name"],[56,69,105,65],[56,70,105,66],[57,14,106,10,"task"],[57,18,106,14],[57,19,106,15,"run"],[57,22,106,18],[57,23,106,19],[57,24,106,20],[58,12,107,8],[58,13,107,9],[58,19,107,15],[59,14,108,10,"require"],[59,21,108,10],[59,22,108,10,"_dependencyMap"],[59,36,108,10],[59,54,109,12],[59,61,109,19,"task"],[59,65,109,23],[59,70,109,28],[59,80,109,38],[59,82,110,12],[59,141,110,71],[59,144,111,14,"JSON"],[59,148,111,18],[59,149,111,19,"stringify"],[59,158,111,28],[59,159,111,29,"task"],[59,163,111,33],[59,165,111,35],[59,169,111,39],[59,171,111,41],[59,172,111,42],[59,173,112,10],[59,174,112,11],[60,14,113,10,"DEBUG"],[60,19,113,15],[60,23,113,19,"console"],[60,30,113,26],[60,31,113,27,"log"],[60,34,113,30],[60,35,113,31],[60,66,113,62],[60,67,113,63],[61,14,114,10,"task"],[61,18,114,14],[61,19,114,15],[61,20,114,16],[62,12,115,8],[63,10,116,6],[63,11,116,7],[63,12,116,8],[63,19,116,15,"e"],[63,20,116,16],[63,22,116,18],[64,12,117,8,"e"],[64,13,117,9],[64,14,117,10,"message"],[64,21,117,17],[64,24,120,10],[64,53,120,39],[64,57,120,43,"task"],[64,61,120,47],[64,62,120,48,"name"],[64,66,120,52],[64,70,120,56],[64,72,120,58],[64,73,120,59],[64,76,120,62],[64,80,120,66],[64,83,120,69,"e"],[64,84,120,70],[64,85,120,71,"message"],[64,92,120,78],[65,12,121,8],[65,18,121,14,"e"],[65,19,121,15],[66,10,122,6],[67,8,123,4],[68,6,124,2],[69,4,124,3],[70,6,124,3,"key"],[70,9,124,3],[71,6,124,3,"value"],[71,11,124,3],[71,13,133,2],[71,22,133,2,"_getCurrentQueue"],[71,38,133,18,"_getCurrentQueue"],[71,39,133,18],[71,41,133,34],[72,8,134,4],[72,12,134,10,"stackIdx"],[72,20,134,18],[72,23,134,21],[72,27,134,25],[72,28,134,26,"_queueStack"],[72,39,134,37],[72,40,134,38,"length"],[72,46,134,44],[72,49,134,47],[72,50,134,48],[73,8,135,4],[73,12,135,10,"queue"],[73,17,135,15],[73,20,135,18],[73,24,135,22],[73,25,135,23,"_queueStack"],[73,36,135,34],[73,37,135,35,"stackIdx"],[73,45,135,43],[73,46,135,44],[74,8,136,4],[74,12,137,6,"queue"],[74,17,137,11],[74,18,137,12,"popable"],[74,25,137,19],[74,29,138,6,"queue"],[74,34,138,11],[74,35,138,12,"tasks"],[74,40,138,17],[74,41,138,18,"length"],[74,47,138,24],[74,52,138,29],[74,53,138,30],[74,57,139,6],[74,61,139,10],[74,62,139,11,"_queueStack"],[74,73,139,22],[74,74,139,23,"length"],[74,80,139,29],[74,83,139,32],[74,84,139,33],[74,86,140,6],[75,10,141,6],[75,14,141,10],[75,15,141,11,"_queueStack"],[75,26,141,22],[75,27,141,23,"pop"],[75,30,141,26],[75,31,141,27],[75,32,141,28],[76,10,142,6,"DEBUG"],[76,15,142,11],[76,19,143,8,"console"],[76,26,143,15],[76,27,143,16,"log"],[76,30,143,19],[76,31,143,20],[76,58,143,47],[76,60,143,49],[77,12,144,10,"stackIdx"],[77,20,144,18],[78,12,145,10,"queueStackSize"],[78,26,145,24],[78,28,145,26],[78,32,145,30],[78,33,145,31,"_queueStack"],[78,44,145,42],[78,45,145,43,"length"],[79,10,146,8],[79,11,146,9],[79,12,146,10],[80,10,147,6],[80,17,147,13],[80,21,147,17],[80,22,147,18,"_getCurrentQueue"],[80,38,147,34],[80,39,147,35],[80,40,147,36],[81,8,148,4],[81,9,148,5],[81,15,148,11],[82,10,149,6],[82,17,149,13,"queue"],[82,22,149,18],[82,23,149,19,"tasks"],[82,28,149,24],[83,8,150,4],[84,6,151,2],[85,4,151,3],[86,6,151,3,"key"],[86,9,151,3],[87,6,151,3,"value"],[87,11,151,3],[87,13,153,2],[87,22,153,2,"_genPromise"],[87,33,153,13,"_genPromise"],[87,34,153,14,"task"],[87,38,153,31],[87,40,153,33],[88,8,158,4],[88,12,158,8],[88,13,158,9,"_queueStack"],[88,24,158,20],[88,25,158,21,"push"],[88,29,158,25],[88,30,158,26],[89,10,158,27,"tasks"],[89,15,158,32],[89,17,158,34],[89,19,158,36],[90,10,158,38,"popable"],[90,17,158,45],[90,19,158,47],[91,8,158,52],[91,9,158,53],[91,10,158,54],[92,8,159,4],[92,12,159,10,"stackIdx"],[92,20,159,18],[92,23,159,21],[92,27,159,25],[92,28,159,26,"_queueStack"],[92,39,159,37],[92,40,159,38,"length"],[92,46,159,44],[92,49,159,47],[92,50,159,48],[93,8,160,4],[93,12,160,10,"stackItem"],[93,21,160,19],[93,24,160,22],[93,28,160,26],[93,29,160,27,"_queueStack"],[93,40,160,38],[93,41,160,39,"stackIdx"],[93,49,160,47],[93,50,160,48],[94,8,161,4,"DEBUG"],[94,13,161,9],[94,17,161,13,"console"],[94,24,161,20],[94,25,161,21,"log"],[94,28,161,24],[94,29,161,25],[94,58,161,54],[94,60,161,56],[95,10,161,57,"stackIdx"],[96,8,161,65],[96,9,161,66],[96,10,161,67],[97,8,162,4,"DEBUG"],[97,13,162,9],[97,17,162,13,"console"],[97,24,162,20],[97,25,162,21,"log"],[97,28,162,24],[97,29,162,25],[97,56,162,52],[97,59,162,55,"task"],[97,63,162,59],[97,64,162,60,"name"],[97,68,162,64],[97,69,162,65],[98,8,163,4,"task"],[98,12,163,8],[98,13,164,7,"gen"],[98,16,164,10],[98,17,164,11],[98,18,164,12],[98,19,165,7,"then"],[98,23,165,11],[98,24,165,12],[98,30,165,18],[99,10,166,8,"DEBUG"],[99,15,166,13],[99,19,167,10,"console"],[99,26,167,17],[99,27,167,18,"log"],[99,30,167,21],[99,31,167,22],[99,64,167,55],[99,67,167,58,"task"],[99,71,167,62],[99,72,167,63,"name"],[99,76,167,67],[99,78,167,69],[100,12,168,12,"stackIdx"],[100,20,168,20],[101,12,169,12,"queueStackSize"],[101,26,169,26],[101,28,169,28],[101,32,169,32],[101,33,169,33,"_queueStack"],[101,44,169,44],[101,45,169,45,"length"],[102,10,170,10],[102,11,170,11],[102,12,170,12],[103,10,171,8,"stackItem"],[103,19,171,17],[103,20,171,18,"popable"],[103,27,171,25],[103,30,171,28],[103,34,171,32],[104,10,172,8],[104,14,172,12],[104,15,172,13,"hasTasksToProcess"],[104,32,172,30],[104,33,172,31],[104,34,172,32],[104,38,172,36],[104,42,172,40],[104,43,172,41,"_onMoreTasks"],[104,55,172,53],[104,56,172,54],[104,57,172,55],[105,8,173,6],[105,9,173,7],[105,10,173,8],[105,11,174,7,"catch"],[105,16,174,12],[105,17,174,13,"ex"],[105,19,174,15],[105,23,174,19],[106,10,175,8,"setTimeout"],[106,20,175,18],[106,21,175,19],[106,27,175,25],[107,12,176,10,"ex"],[107,14,176,12],[107,15,176,13,"message"],[107,22,176,20],[107,25,176,23],[107,71,176,69,"task"],[107,75,176,73],[107,76,176,74,"name"],[107,80,176,78],[107,85,176,83,"ex"],[107,87,176,85],[107,88,176,86,"message"],[107,95,176,93],[107,97,176,95],[108,12,177,10],[108,18,177,16,"ex"],[108,20,177,18],[109,10,178,8],[109,11,178,9],[109,13,178,11],[109,14,178,12],[109,15,178,13],[110,8,179,6],[110,9,179,7],[110,10,179,8],[111,6,180,2],[112,4,180,3],[113,2,180,3],[114,2,180,3],[114,6,180,3,"_default"],[114,14,180,3],[114,17,180,3,"exports"],[114,24,180,3],[114,25,180,3,"default"],[114,32,180,3],[114,35,183,15,"TaskQueue"],[114,44,183,24],[115,0,183,24],[115,3]],"functionMap":{"names":["<global>","TaskQueue","constructor","enqueue","enqueueTasks","tasks.forEach$argument_0","cancelTasks","_queueStack.map$argument_0","queue.tasks.filter$argument_0","_queueStack.map.filter$argument_0","hasTasksToProcess","processNext","_getCurrentQueue","_genPromise","task.gen.then$argument_0","task.gen.then._catch$argument_0","setTimeout$argument_0"],"mappings":"AAA;AC0C;ECQ;GDG;EEO;GFE;EGE;kBCC,0BD;GHC;EKE;WCG;kCCE,0CD;QDC;cGC,mDH;GLC;ESY;GTE;EUK;GV4B;EWS;GXkB;EYE;YCY;ODQ;aEC;mBCC;SDG;OFC;GZC;CDC"}},"type":"js/module"}]}